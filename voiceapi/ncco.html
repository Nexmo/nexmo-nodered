<!-- Talk -->
<script type="text/javascript">
    RED.nodes.registerType('talk', {
        category: 'Vonage APIs',
        color: '#80C7F5',
        defaults: {
            text: { required: true },
            template: {},
            voicename: {},
            bargein: {},
            loop: {},
            level: {},
        },
        inputs: 1,
        outputs: 1,
        icon: "vonage-white.svg",
        label: "Talk",
        paletteLabel: "Talk"
    });
</script>

<script type="text/x-red" data-template-name="talk">
    <div class="form-row">
        <label for="node-input-text"><i class="icon-tag"></i>Text {}</label>
        <input type="text" id="node-input-text" placeholder="text">
    </div>
    
    <div class="form-row">
        <label for="node-input-voicename"><i class="icon-tag"></i>Voice Name {}</label>
        <input type="text" id="node-input-voicename" placeholder="Kimberley">
    </div>
    
    <div class="form-row">
        <label for="node-input-bargein"><i class="icon-tag"></i>Barge In</label>
        <input type="checkbox" id="node-input-bargein">
    </div>
    
    <div class="form-row">
        <label for="node-input-loop"><i class="icon-tag"></i>Loop</label>
        <input type="text" id="node-input-loop">
    </div>
    
    <div class="form-row">
        <label for="node-input-level"><i class="icon-tag"></i>Level</label>
        <input type="text" id="node-input-level">
    </div>
</script>

<script type="text/x-red" data-help-name="talk">
<p>Adds a talk action to an NCCO</p>

<h3>Inputs</h3>
    <dl class="message-properties">
        <dt>ncco<span class="property-type">object</span></dt>
        <dd> The output of a previous action, if no <code>msg.ncco</code> exists it will be created  </dd>
    </dl>

 <h3>Outputs</h3>
 <dl class="message-properties">
     <dt>ncco<span class="property-type">object</span></dt>
     <dd> <code>msg.ncco</code> will contain any previous actions provided to the input with the new <code>talk</code> action appended  </dd>
 </dl>

<h3>Details</h3>
The talk action sends synthesized speech to a Conversation.

The text provided in the talk action can either be plain, or formatted using SSML. SSML tags provide further instructions to the text-to-speech synthesiser which allow you to set pitch, pronunciation and to combine together text in multiple languages. SSML tags are XML-based and sent inline in the text string.
By default, the talk action is synchronous. However, if you set Barge In to true you must set an input action later in the NCCO flow. 

<h3>References</h3>
    <ul>
        <li><a href="https://developer.vonage.com/voice/voice-api/ncco-reference#talk">Vonage NCCO Reference</a></li>
    </ul>
</script>


<!-- Stream -->
<script type="text/javascript">
    RED.nodes.registerType('stream', {
        category: 'Vonage APIs',
        color: '#80C7F5',
        defaults: {
            streamurl: { required: true },
            bargein: {},
            loop: {},
            level: {}
        },
        inputs: 1,
        outputs: 1,
        icon: "vonage-white.svg",
        label: "Stream",
        paletteLabel: "Stream"
    });
</script>

<script type="text/x-red" data-template-name="stream">
    <div class="form-row">
        <label for="node-input-streamurl"><i class="icon-tag"></i>Stream URL {}</label>
        <input type="text" id="node-input-streamurl" placeholder="https://example.com/audio.mp3">
    </div>
    
    <div class="form-row">
        <label for="node-input-bargein"><i class="icon-tag"></i>Barge In</label>
        <input type="checkbox" id="node-input-bargein">
    </div>
    
    <div class="form-row">
        <label for="node-input-loop"><i class="icon-tag"></i>Loop</label>
        <input type="text" id="node-input-loop">
    </div>
    
    <div class="form-row">
        <label for="node-input-level"><i class="icon-tag"></i>Level</label>
        <input type="text" id="node-input-level">
    </div>
</script>

<script type="text/x-red" data-help-name="stream">
<p>Adds a stream action to an NCCO</p>

<h3>Inputs</h3>
    <dl class="message-properties">
        <dt>ncco<span class="property-type">object</span></dt>
        <dd> The output of a previous action, if no <code>msg.ncco</code> exists it will be created  </dd>
    </dl>

 <h3>Outputs</h3>
 <dl class="message-properties">
     <dt>ncco<span class="property-type">object</span></dt>
     <dd> <code>msg.ncco</code> will contain any previous actions provided to the input with the new <code>stream</code> action appended  </dd>
 </dl>

<h3>Details</h3>
The stream action allows you to send an audio stream to a Call or a Conversation.

By default, the stream action is synchronous. However, if you set bargeIn to true you must set an input action folowing this.

<br>The <b>Stream URL {}</b> will be an array containing a single URL to an MP3 or WAV (16-bit) audio file.

<h3>References</h3>
    <ul>
        <li><a href="https://developer.vonage.com/voice/voice-api/ncco-reference#stream">Vonage NCCO Reference</a></li>
    </ul>
</script>


<!-- Input -->
<script type="text/javascript">
    RED.nodes.registerType('input', {
        category: 'Vonage APIs',
        color: '#80C7F5',
        defaults: {
            eventurl: {},
            eventmethod: {},
            timeout: {},
            maxdigits: {},
            submitonhash: {}
        },
        inputs: 1,
        outputs: 1,
        icon: "vonage-white.svg",
        label: "Input",
        paletteLabel: "Input"
    });
</script>

<script type="text/x-red" data-template-name="input">
    <div class="form-row">
        <label for="node-input-eventurl"><i class="icon-tag"></i>URL {}</label>
        <input type="text" id="node-input-eventurl" placeholder="https://example.com/webhooks/input">
    </div>
    
    <div class="form-row">
        <label for="node-input-eventmethod"><i class="fa fa-tasks"></i>Method</label>
        <select type="text" id="node-input-eventmethod" style="width:70%;">
        <option value="get">GET</option>
        <option value="post">POST</option>
         </select>
    </div>
    
    <div class="form-row">
        <label for="node-input-submitonhash"><i class="icon-tag"></i>Submit On Hash</label>
        <input type="checkbox" id="node-input-submitonhash" style="width:70%;">
    </div>
    
    <div class="form-row">
        <label for="node-input-timeout"><i class="icon-tag"></i>Time Out</label>
        <input type="text" id="node-input-timeout">
    </div>
    
    <div class="form-row">
        <label for="node-input-maxdigits"><i class="icon-tag"></i>Max Digits</label>
        <input type="text" id="node-input-maxdigits">
    </div>
</script>

<script type="text/x-red" data-help-name="input">
<p>Adds an input action to an NCCO</p>

<h3>Inputs</h3>
    <dl class="message-properties">
        <dt>ncco<span class="property-type">object</span></dt>
        <dd> The output of a previous action, if no <code>msg.ncco</code> exists it will be created  </dd>
    </dl>

 <h3>Outputs</h3>
 <dl class="message-properties">
     <dt>ncco<span class="property-type">object</span></dt>
     <dd> <code>msg.ncco</code> will contain any previous actions provided to the input with the new <code>stream</code> action appended  </dd>
 </dl>

<h3>Details</h3>
The input action collects DTMF input from the caller.

You can use the input action to collect digits input by the person you are calling. This action is synchronous, Vonage processes the input and forwards it in the parameters sent to the eventURL webhook endpoint you configure in your request, you will need to use the full url including the hostname here of your webhook here.
Your webhook endpoint should return another NCCO that replaces the existing NCCO and controls the Call based on the user input. 

<h3>References</h3>
    <ul>
        <li><a href="https://developer.vonage.com/voice/voice-api/ncco-reference#input">Vonage NCCO Reference</a></li>
    </ul>
</script>


<!-- Record -->
<script type="text/javascript">
    RED.nodes.registerType('record', {
        category: 'Vonage APIs',
        color: '#80C7F5',
        defaults: {
            format: {},
            split: {},
            channel: {},
            endonsilence: {},
            endonkey: {},
            timeout: {},
            beepstart: {},
            eventurl: {},
            eventmethod: {}
        },
        inputs: 1,
        outputs: 1,
        icon: "vonage-white.svg",
        label: "Record",
        paletteLabel: "Record"
    });
</script>

<script type="text/x-red" data-template-name="record">
    <div class="form-row">
        <label for="node-input-eventurl"><i class="icon-tag"></i>URL {}</label>
        <input type="text" id="node-input-eventurl" placeholder="https://example.com/webhooks/record">
    </div>
    
    <div class="form-row">
        <label for="node-input-eventmethod"><i class="fa fa-tasks"></i>Method</label>
        <select type="text" id="node-input-eventmethod" style="width:70%;">
          <option value="get">GET</option>
          <option value="post">POST</option>
         </select>
    </div>
    
    <div class="form-row">
        <label for="node-input-format"><i class="fa fa-tasks"></i>Format</label>
        <select type="text" id="node-input-format" style="width:70%;">
          <option value="mp3">MP3</option>
          <option value="wav">WAV</option>
          <option value="ogg">OGG</option>
         </select>
    </div>
    
    <div class="form-row">
        <label for="node-input-split"><i class="fa fa-tasks"></i>Split</label>
        <select type="text" id="node-input-split" style="width:70%;">
        <option value="conversation">Conversation</option>
         </select>
    </div>
    
    <div class="form-row">
        <label for="node-input-channel"><i class="icon-tag"></i>Channels</label>
        <input type="number" id="node-input-channel">
    </div>
    
    <div class="form-row">
        <label for="node-input-endonsilence"><i class="icon-tag"></i>End On Silence</label>
        <input type="number" id="node-input-endonsilence">
    </div>
    
    <div class="form-row">
        <label for="node-input-endonkey"><i class="icon-tag"></i>End On Key</label>
        <input type="text" id="node-input-endonkey">
    </div>
        
    
    <div class="form-row">
        <label for="node-input-timeout"><i class="icon-tag"></i>Time Out</label>
        <input type="number" id="node-input-timeout">
    </div>
    
    
    <div class="form-row">
        <label for="node-input-beepstart"><i class="icon-tag"></i>Beep Start</label>
        <input type="checkbox" id="node-input-beepstart">
    </div>
</script>

<script type="text/x-red" data-help-name="record">
<p>Adds a record action to an NCCO</p>

<h3>Inputs</h3>
    <dl class="message-properties">
        <dt>ncco<span class="property-type">object</span></dt>
        <dd> The output of a previous action, if no <code>msg.ncco</code> exists it will be created  </dd>
    </dl>

 <h3>Outputs</h3>
 <dl class="message-properties">
     <dt>ncco<span class="property-type">object</span></dt>
     <dd> <code>msg.ncco</code> will contain any previous actions provided to the input with the new <code>stream</code> action appended  </dd>
 </dl>

<h3>Details</h3>
The record action records audio from a caller or records the call.

The record action is asynchronous. Recording starts when the record action is executed in the NCCO and finishes when the synchronous condition in the action is met. That is, endOnSilence, timeOut or endOnKey. If you do not set a synchronous condition, the Voice API immediately executes the next NCCO without recording.

<h3>References</h3>
    <ul>
        <li><a href="https://developer.vonage.com/voice/voice-api/ncco-reference#record">Vonage NCCO Reference</a></li>
    </ul>
</script>


<!-- Conversation -->
<script type="text/javascript">
    RED.nodes.registerType('conversation', {
        category: 'Vonage APIs',
        color: '#80C7F5',
        defaults: {
            name: { required: true },
            musiconholdurl: {},
            startonenter: {},
            endonexit: {},
            record: {},
            eventurl: {},
            eventmethod: {},
            canspeak: {},
            canhear: {}
        },
        inputs: 1,
        outputs: 1,
        icon: "vonage-white.svg",
        label: "Conversation",
        paletteLabel: "Conversation"
    });
</script>

<script type="text/x-red" data-template-name="conversation">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i>Name {}</label>
        <input type="text" id="node-input-name" placeholder="text">
    </div>
    
    <div class="form-row">
        <label for="node-input-musiconholdurl"><i class="icon-tag"></i>Music On Hold URL {}</label>
        <input type="text" id="node-input-musiconholdurl" placeholder="https://example.com/audio.mp3">
    </div>
    
    <div class="form-row">
        <label for="node-input-startonenter"><i class="icon-tag"></i>Start On Enter</label>
        <input type="checkbox" checked  id="node-input-startonenter">
    </div>
 
    <div class="form-row">
        <label for="node-input-endonexit"><i class="icon-tag"></i>End On Exit</label>
        <input type="checkbox"  id="node-input-endonexit">
    </div>   
   
    <div class="form-row">
        <label for="node-input-record"><i class="icon-tag"></i>Record</label>
        <input type="checkbox"  id="node-input-record">
    </div>   
   
    <div class="form-row">
        <label for="node-input-eventurl"><i class="icon-tag"></i>Recording Event URL {}</label>
        <input type="text" id="node-input-eventurl">   
    </div>
   
    <div class="form-row">
        <label for="node-input-eventmethod"><i class="fa fa-tasks"></i>Method</label>
        <select type="text" id="node-input-eventmethod" style="width:70%;">
          <option value="get">GET</option>
          <option value="post">POST</option>
         </select>
    </div>

    <div class="form-row">
        <label for="node-input-canhear"><i class="icon-tag"></i>Can Hear {}</label>
        <input type="text" id="node-input-canhear">
    </div>   
   
    <div class="form-row">
        <label for="node-input-canspeak"><i class="icon-tag"></i>Can Speak {}</label>
        <input type="text"  id="node-input-canspeak">
    </div>   
</script>

<script type="text/x-red" data-help-name="conversation">
<p>Adds a conversaton action to an NCCO</p>

<h3>Inputs</h3>
    <dl class="message-properties">
        <dt>ncco<span class="property-type">object</span></dt>
        <dd> The output of a previous action, if no <code>msg.ncco</code> exists it will be created  </dd>
    </dl>

 <h3>Outputs</h3>
 <dl class="message-properties">
     <dt>ncco<span class="property-type">object</span></dt>
     <dd> <code>msg.ncco</code> will contain any previous actions provided to the input with the new <code>stream</code> action appended  </dd>
 </dl>

<h3>Details</h3>
The conversation action creates a named Conference.

You can use the conversation action to create standard or moderated conferences. The first person to call the virtual number assigned to the conversation creates it. This action is synchronous, the conversation lasts until the number of participants is 0.

Can Hear and Can Speak should be a comma separated list of call UUIDs

<h3>References</h3>
    <ul>
        <li><a href="https://developer.vonage.com/voice/voice-api/ncco-reference#conversation">Vonage NCCO Reference</a></li>
    </ul>
</script>


<!-- Connect -->
<script type="text/javascript">
    RED.nodes.registerType('connect', {
        category: 'Vonage APIs',
        color: '#80C7F5',
        defaults: {
            endpoint: {},
            to: {},
            wsuri: {},
            sipuri: {},
            extension: {},
            from: {},
            dtmfanswer: {},
            onanswer: {},
            contenttype: {},
            headers: {},
            eventtype: {},
            timeout: {},
            machinedetection: {},
            limit: {},
            eventurl: {},
            eventmethod: {}
        },
        inputs: 1,
        outputs: 1,
        icon: "vonage-white.svg",
        label: "Connect",
        paletteLabel: "Connect"
    });
</script>

<script type="text/x-red" data-template-name="connect">

  <div class="form-row">
      <label for="node-input-endpoint"><i class="fa fa-tasks"></i>Endpoint</label>
      <select type="text" id="node-input-endpoint" style="width:70%;" onchange="toggleEndpointNCCO(this.value)">
        <option value="phone">Phone</option>
        <option value="sip">SIP</option>
        <option value="websocket">Websocket</option>
        <option value="vbc">VBC Extension</option>
       </select>
  </div>
  
  <div id="phone" style="display: none;">
    <div class="form-row" >
       <label for="node-input-to"><i class="icon-tag"></i>Number {}</label>
       <input type="text" id="node-input-to" placeholder="number">
    </div>
    <div class="form-row" >
       <label for="node-input-dtmfanswer"><i class="icon-tag"></i>dtmfAnswer {}</label>
       <input type="text" id="node-input-dtmfanswer" placeholder="digits">
    </div>
    <div  class="form-row" >
       <label for="node-input-onanswer"><i class="icon-tag"></i>onAnswer {}</label>
       <input type="text" id="node-input-onanswer" placeholder="https://example.com/webhooks/ncco">
    </div>
  </div>
  
  <div id="websocket" style="display: none;">
    <div class="form-row">
      <label for="node-input-wsuri"><i class="icon-tag"></i>URI {}</label>
      <input type="text" id="node-input-wsuri" placeholder="wss://example.com/socket">
    </div>
    <div class="form-row">
        <label for="node-input-contenttype"><i class="fa fa-tasks"></i>Sample Rate</label>
        <select type="text" id="node-input-contenttype" style="width:70%;">
          <option value="audio/l16;rate=16000">16Khz</option>
          <option value="audio/l16;rate=8000">8Khz</option>
         </select>
    </div>
    <div class="form-row">
      <label for="node-input-headers"><i class="icon-tag"></i>Headers {}</label>
      <input type="text" id="node-input-headers" placeholder='{"foo" : "bar"}'>
    </div>
  </div>
  
  <div id="sip" style="display: none;">
    <div class="form-row">
      <label for="node-input-sipuri"><i class="icon-tag"></i>URI {}</label>
      <input type="text" id="node-input-sipuri" placeholder="sip:1000@example.com">
    </div>
  </div>
  
  <div id="vbc" style="display: none;">
    <div class="form-row">
      <label for="node-input-extension"><i class="icon-tag"></i>Extension {}</label>
      <input type="text" id="node-input-extension" placeholder="1234">
    </div>
  </div>
    
    <div class="form-row">
        <label for="node-input-from"><i class="icon-tag"></i>From {}</label>
        <input type="text" id="node-input-from" placeholder="From Number">
    </div>
    
    <div class="form-row">
        <label for="node-input-eventtype"><i class="icon-tag"></i>Synchronous (event type)</label>
        <input type="checkbox" value="synchronous" id="node-input-eventtype">
    </div>   
    
    <div class="form-row">
        <label for="node-input-timeout"><i class="icon-tag"></i>Timeout</label>
        <input type="number" id="node-input-timeout" placeholder="60">
    </div>
     
    <div class="form-row">
        <label for="node-input-limit"><i class="icon-tag"></i>Limit</label>
        <input type="number" id="node-input-limit" placeholder="7200">
    </div>
    
    <div class="form-row">
        <label for="node-input-machinedetection"><i class="fa fa-tasks"></i>Machine Detection</label>
        <select type="text" id="node-input-machinedetection" style="width:70%;">
          <option value="">none</option>
          <option value="continue">continue</option>
          <option value="hangup">hangup</option>
         </select>
    </div>
    
    <div class="form-row">
        <label for="node-input-eventurl"><i class="icon-tag"></i>Event URL {}</label>
        <input type="text" id="node-input-eventurl" placeholder="/url">
    </div>
   
    <div class="form-row">
        <label for="node-input-eventmethod"><i class="fa fa-tasks"></i>Method</label>
        <select type="text" id="node-input-eventmethod" style="width:70%;">
          <option value="get">GET</option>
          <option value="post">POST</option>
         </select>
    </div>    
</script>

<script>
    function toggleEndpointNCCO(endpoint) {
        console.log(endpoint);
        if (endpoint == 'phone') {
            document.getElementById("phone").style.display = "block";
            document.getElementById("websocket").style.display = "none";
            document.getElementById("sip").style.display = "none";
            document.getElementById("vbc").style.display = "none";

        }
        else if (endpoint == 'websocket') {
            document.getElementById("phone").style.display = "none";
            document.getElementById("websocket").style.display = "block";
            document.getElementById("sip").style.display = "none";
            document.getElementById("vbc").style.display = "none";

        } else if (endpoint == 'sip') {
            document.getElementById("phone").style.display = "none";
            document.getElementById("websocket").style.display = "none";
            document.getElementById("sip").style.display = "block";
            document.getElementById("vbc").style.display = "none";
        } else if (endpoint == 'vbc') {
            document.getElementById("phone").style.display = "none";
            document.getElementById("websocket").style.display = "none";
            document.getElementById("sip").style.display = "none";
            document.getElementById("vbc").style.display = "block";
        }
    }
</script>

<script type="text/x-red" data-help-name="connect">
<p>Adds a connect action to an NCCO</p>

<h3>Inputs</h3>
    <dl class="message-properties">
        <dt>ncco<span class="property-type">object</span></dt>
        <dd> The output of a previous action, if no <code>msg.ncco</code> exists it will be created  </dd>
    </dl>

 <h3>Outputs</h3>
 <dl class="message-properties">
     <dt>ncco<span class="property-type">object</span></dt>
     <dd> <code>msg.ncco</code> will contain any previous actions provided to the input with the new <code>stream</code> action appended  </dd>
 </dl>

<h3>Details</h3>
You can use the connect action to connect a call to endpoints such as phone numbers.

This action is synchronous, after a connect the next action in the NCCO stack is processed. A connect action ends when the endpoint you are calling is busy or unavailable. You ring endpoints sequentially by nesting connect actions.

<h3>References</h3>
    <ul>
        <li><a href="https://developer.vonage.com/voice/voice-api/ncco-reference#connect">Vonage NCCO Reference</a></li>
    </ul>
</script>


<!-- Notify -->
<script type="text/javascript">
    RED.nodes.registerType('notify', {
        category: 'Vonage APIs',
        color: '#80C7F5',
        defaults: {
            payload: { required: true },
            eventurl: { required: true },
            eventmethod: {}
        },
        inputs: 1,
        outputs: 1,
        icon: "vonage-white.svg",
        label: "Notify",
        paletteLabel: "Notify",
        oneditprepare: function () {
            $("#node-input-payload").typedInput({ types: ['json'] });
            $("#node-input-eventurl").typedInput({
                default: 'post',
                types: [{ value: "get", label: "GET" }, { value: "post", label: "POST" }],
                typeField: $("#node-input-eventmethod")
            });
        }
    });
</script>

<script type="text/x-red" data-template-name="notify">
    <div class="form-row">
        <label for="node-input-payload"><i class="icon-tag"></i>Payload {}</label>
        <input type="text" id="node-input-payload">
    </div>

    <div class="form-row">
        <label for="node-input-eventurl"><i class="icon-tag"></i>Event URL {}</label>
        <input type="text" id="node-input-eventurl" placeholder="https://example.com/webhooks/event">
        <input type="hidden" id="node-input-eventmethod">
    </div>  
</script>

<script type="text/x-red" data-help-name="notify">
    <p>Adds a notify action to an NCCO</p>
    <h3>Inputs</h3>
        <dl class="message-properties">
            <dt>ncco<span class="property-type">object</span></dt>
            <dd> The output of a previous action, if no <code>msg.ncco</code> exists it will be created  </dd>
        </dl>
        
     <h3>Outputs</h3>
        <dl class="message-properties">
          <dt>ncco<span class="property-type">object</span></dt>
          <dd> <code>msg.ncco</code> will contain any previous actions provided to the input with the new <code>stream</code> action appended  </dd>
        </dl>

     <h3>Details</h3>
        The notify action sends a custom <code>payload</code> to your <code>Event URL</code>.
        You can optonally respond to that webhook with a new NCCO containing actions to execute on the call

     <h3>References</h3>
          <ul>
              <li><a href="https://developer.vonage.com/voice/voice-api/ncco-reference#notify">Vonage NCCO Reference</a></li>
          </ul>
</script>