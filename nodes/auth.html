
<script type="text/javascript">
    RED.nodes.registerType('nexmovoiceapp',{
        category: 'config',
        defaults: {
          name: {}
        },
         credentials: {
           apikey: {type:"text"},
           apisecret: {type:"text"},
           answerurl: {type:"text"},
           eventurl: {type:"text"},
           appid: {type:"text"},
           privatekey: {type:"text"}
        },
        label: function() {
            return this.name;
        }
    });
</script>

<script type="text/x-red" data-template-name="nexmovoiceapp">
  <div class="form-row">
      <label for="node-config-input-name">Name</label>
      <input type="text" id="node-config-input-name" placeholder="Name">
  </div>
  
  <div class="form-row">
      <label for="node-config-input-apikey">API Key</label>
      <input type="text" id="node-config-input-apikey" placeholder="Nexmo API Key">
  </div>
  
  <div class="form-row">
      <label for="node-config-input-apisecret">API Secret</label>
      <input type="text" id="node-config-input-apisecret" placeholder="Nexmo API Secret">
  </div>
  
  <div class="form-row">
      <label for="node-config-input-answerurl"></i>Answer URL</label>
      <input type="text" id="answerurl" placeholder="http://example.com/answer">
  </div>
  <div class="form-row">
      <label for="node-config-input-appid"></i>Event URL</label>
      <input type="text" id="eventurl" placeholder="http://example.com/event">
  </div>
  
	<div class="form-row">
    <button id="button" onclick="newnexmovoiceapp()">Create New Application</button><br>   
  </div>
  
  <div class="form-row">
      <label for="node-config-input-appid"></i>App ID</label>
      <input type="text" id="node-config-input-appid" placeholder="Application ID" disabled>
  </div>
  
  <div class="form-row">
      <label for="node-config-input-privatekey"></i>Private Key</label>
      <textarea id="node-config-input-privatekey", placeholder="Private Key" rows="30" cols="50" disabled></textarea>
  </div>
</script>

<script type="text/x-red" data-help-name="nexmovoiceapp">
   <p>Creates a new Nexmo Voice Application </p>
   <h3>Details</h3>
   <p>Enter your details in the boxes above and click, Create Application, node-red will then create a new nexmo application on your account and fill in the Dpp ID and Private Key fields for you to save.</p>
   <p> This auth module can be used by any Nexmo Voice nodes that require auth.</p>
</script>


<script>

  function newnexmovoiceapp(){
    var url = 'nexmo-auth/new-voice-app';
      console.log(url);
      var params = {
        api_key:  document.getElementById("node-config-input-apikey").value,
        api_secret: document.getElementById("node-config-input-apisecret").value,
        name : document.getElementById("node-config-input-name").value,
        answer_url : document.getElementById("answerurl").value,
        event_url : document.getElementById("eventurl").value
      }
      console.log(params);
      $.post(url, params, function(res){
		    console.log(res);
        document.getElementById("node-config-input-appid").value = res.id;
        document.getElementById("node-config-input-privatekey").value = res.keys.private_key;
        }, 'json'
      );
  }
</script>
    
    
<script type="text/javascript">
    RED.nodes.registerType('nexmobasic',{
        category: 'config',
        credentials: {
          apikey: {type:"text"},
          apisecret: {type:"text"}
        },
        label: function() {
            return this.credentials.apikey;
        }
    });
</script>

<script type="text/x-red" data-template-name="nexmobasic">
  <div class="form-row"></
      <label for="node-config-input-apikey">API Key</label>
      <input type="text" id="node-config-input-apikey" placeholder="Nexmo API Key">
  </div>
  
  <div class="form-row">
      <label for="node-config-input-apisecret">API Secret</label>
      <input type="text" id="node-config-input-apisecret" placeholder="Nexmo API Secret">
  </div>
</script>

<script type="text/x-red" data-help-name="nexmobasic">
   <p>Creates a new Nexmo Basic Auth node </p>
   <h3>Details</h3>
   <p>Enter your api key and secret</p>
   <p> This auth module will be used by nodes that require basic auth such as SMS, Verify and Number Insight.</p>
</script>





<script type="text/javascript">
    RED.nodes.registerType('nexmoapp',{
        category: 'config',
        defaults: {
          name: {}
        },
         credentials: {
           apikey: {type:"text"},
           apisecret: {type:"text"},
           voiceanswerurl: {type:"text"},
           voiceeventurl: {type:"text"},
           rtceventurl: {type:"text"},
           appid: {type:"text"},
           privatekey: {type:"text"},
           msginboundurl: {type:"text"},
           msgstatusurl: {type:"text"}
           voice_answer_method : {type:"text"}
        },
        label: function() {
            return this.name;
        },
        oneditprepare: function() {
          $("#node-config-input-voice_answer_method").val(this.credentials.voice_answer_method);
          $("#node-config-input-voiceanswerurl").typedInput({
              default: 'GET',
              typeField: $("#node-input-voice_answer_method"),
              types:[{value:"GET",label:"GET"},{value:"POST",label:"POST"}]
          });
        }
      });
</script>

<script type="text/x-red" data-template-name="nexmoapp">
  <div class="form-row">
      <label for="node-config-input-name">Name</label>
      <input type="text" id="node-config-input-name" placeholder="Name">
  </div>
  
  <div id="appdetails">
  <div class="form-row">
      <label for="node-config-input-apikey">API Key</label>
      <input type="text" id="node-config-input-apikey" placeholder="Nexmo API Key">
  </div>
  
  <div class="form-row">
      <label for="node-config-input-apisecret">API Secret</label>
      <input type="text" id="node-config-input-apisecret" placeholder="Nexmo API Secret">
  </div>
  <h3>Capabilities</h3>
  <div class="form-row">
      <label for="node-input-voicecap"><i class="icon-tag"></i>Voice</label>
      <input type="checkbox" id="node-input-voicecap" onclick='updatecaps(this);'>
      <label for="node-input-rtccap"><i class="icon-tag"></i>RTC</label>
	    <input type="checkbox" id="node-input-rtccap" onclick='updatecaps(this);'>
      <label for="node-input-vbccap"><i class="icon-tag"></i>VBC</label>
	    <input type="checkbox" id="node-input-vbccap">
      <label for="node-input-msgcap"><i class="icon-tag"></i>Messages</label>
	    <input type="checkbox" id="node-input-msgcap" onclick='updatecaps(this);'>
  </div>
  
  <div id="voice" style="display:none">
      <h3>Voice</h3>
  	<div class="form-row">
      <label for="node-config-input-voiceanswerurl"></i>Answer URL</label>
      <input type="text" id="node-config-voice-answerurl" placeholder="http://example.com/answer">
  	</div>
  	<div class="form-row">
      <label for="node-config-voice-eventurl"></i>Event URL</label>
      <input type="text" id="node-config-voice-eventurl" placeholder="http://example.com/event">
  	</div>
  </div>
  
  <div id="rtc" style="display:none">
      <h3>RTC</h3>
  	<div class="form-row">
      <label for="node-config-rtc-eventurl"></i>Event URL</label>
      <input type="text" id="node-config-rtc-eventurl" placeholder="http://example.com/event">
  	</div>
  </div>
  
  <div id="messages" style="display:none">
      <h3>Messages</h3>
  	<div class="form-row">
      <label for="node-config-msg-inboundurl"></i>Inbound URL</label>
      <input type="text" id="node-config-msg-inboundurl" placeholder="http://example.com/event">
  	</div>
  	<div class="form-row">
      <label for="node-config-msg-statusurl"></i>Status URL</label>
      <input type="text" id="node-config-msg-statusurl" placeholder="http://example.com/event">
  	</div>  
  </div>
  
  
	 <div class="form-row">
    <button id="button" onclick="newnexmoapp()">Create New Application</button><br> 
      
    <h3>Advanced</h3>
	  <button id="button" onclick="advancedapp()">Use Existing Application Credentials</button><br>   
   </div>
  
  </div>
  
  <div id="appcreds" style="display:none">
  	<div class="form-row">
      <label for="node-config-input-appid"></i>App ID</label>
      <input type="text" id="node-config-input-appid" placeholder="Application ID" disabled>
  	</div>
  	<div class="form-row">
      <label for="node-config-input-privatekey"></i>Private Key</label>
      <textarea id="node-config-input-privatekey", placeholder="Private Key" rows="30" cols="50" disabled style="width: 340px; height: 300px;"></textarea>
  	</div>
  </div>
  
</script>

<script type="text/x-red" data-help-name="nexmoapp">
   <p>Creates a new Nexmo Voice Application </p>
   <h3>Details</h3>
   <p>Enter your details in the boxes above and click, Create Application, node-red will then create a new nexmo application on your account and fill in the Dpp ID and Private Key fields for you to save.</p>
   <p> This auth module can be used by any Nexmo Voice nodes that require auth.</p>
</script>



//test

  <script type="text/javascript">
      RED.nodes.registerType('nexmotest',{
          category: 'nexmo',
          color: '#35be8b',
          defaults: {
            creds: {value:"", type:"nexmoapp"},
          },
          inputs:1,
          outputs:1,
          icon: "nexmo.png",
          label: "TEST"
      });
  </script>
  <script type="text/x-red" data-template-name="nexmotest">
    <div class="form-row">
        <label for="node-config-input-privatekey"></i>Nexmo Credentials</label>
        <input type="text" id="node-input-creds" >
    </div>
  
    <div class="form-row">
        <label for="node-input-calluuid"><i class="icon-tag"></i>Call UUID {}</label>
        <input type="text" id="node-input-calluuid" placeholder="UUID">
    </div>
  
    <div class="form-row">
        <label for="node-input-digits"><i class="icon-tag"></i>Digits {}</label>
        <input type="text" id="node-input-digits">
    </div>
  </script>


  <script type="text/x-red" data-help-name="nexmotest">
  <p>Test Node</p>

  </script>




<script>

  function newnexmovoiceapp(){
    var url = 'nexmo-auth/new-voice-app';
      console.log(url);
      var params = {
        api_key:  document.getElementById("node-config-input-apikey").value,
        api_secret: document.getElementById("node-config-input-apisecret").value,
        name : document.getElementById("node-config-input-name").value,
        answer_url : document.getElementById("answerurl").value,
        event_url : document.getElementById("eventurl").value
      }
      console.log(params);
      $.post(url, params, function(res){
		console.log(res);
		document.getElementById("appdetails").style.display = "none";
		document.getElementById("appcreds").style.display = "block";
        document.getElementById("node-config-input-appid").value = res.id;
        document.getElementById("node-config-input-privatekey").value = res.keys.private_key;
        }, 'json'
      );
  }
  
  function newnexmoapp(){
      console.log('FUNCTION CALLED')
      var url = 'nexmo-auth/new-app';
      console.log(url);
      var params = {
        api_key:  document.getElementById("node-config-input-apikey").value,
        api_secret: document.getElementById("node-config-input-apisecret").value,
        name : document.getElementById("node-config-input-name").value,
        voice_answer_url : document.getElementById("node-config-voice-answerurl").value,
        voice_answer_method : 'POST',
        voice_event_url : document.getElementById("node-config-voice-eventurl").value,
        voice_event_method : 'POST',
        rtc_event_url : document.getElementById("node-config-rtc-eventurl").value,
        rtc_event_method : 'POST',
        msg_inbound_url : document.getElementById("node-config-msg-inboundurl").value,
        msg_inbound_method : 'POST',
        msg_status_url : document.getElementById("node-config-msg-statusurl").value,
        voice_cap : document.getElementById("node-input-voicecap").checked,
        rtc_cap : document.getElementById("node-input-rtccap").checked,
        msg_cap : document.getElementById("node-input-msgcap").checked,
        vbc_cap : document.getElementById("node-input-vbccap").checked
      }
      console.log(params);
      $.post(url, params, function(res){
		console.log(res);
		document.getElementById("appdetails").style.display = "none";
		document.getElementById("appcreds").style.display = "block";
        document.getElementById("node-config-input-appid").value = res.id;
        document.getElementById("node-config-input-privatekey").value = res.keys.private_key;
        }, 'json'
      );
  }
  
  function advancedapp(){
	document.getElementById("appdetails").style.display = "none";
	document.getElementById("appcreds").style.display = "block";
	document.getElementById("node-config-input-appid").disabled = false;
	document.getElementById("node-config-input-privatekey").disabled = false
  }
  
  function updatecaps(item){
    switch(item.id){
    case 'node-input-voicecap':
      if (item.checked == true){
        document.getElementById("voice").style.display = "block";
      }
      else {
        document.getElementById("voice").style.display = "none";
      }
      break;
    case 'node-input-rtccap':
      if (item.checked == true){
        document.getElementById("rtc").style.display = "block";
      }
      else {
        document.getElementById("rtc").style.display = "none";
      }
      break;
    case 'node-input-msgcap':
      if (item.checked == true){
        document.getElementById("messages").style.display = "block";
      }
      else {
        document.getElementById("messages").style.display = "none";
      }
      break;
    }
  }
</script>
  
  

